import{r as k,j as f}from"../jse/index-index-CuT9J82M.js";import{u as G,a as A,D as U,S as q,b as z,c as x,K as F,T as H,M as J}from"./sortable.esm-CcMcRktF.js";import{r as L}from"./index-CNgUcgqS.js";import{BoardContainer as N,BoardColumn as P}from"./BoardColumn-BYwl2cl4.js";import{T as Q,c as V}from"./multipleContainersKeyboardPreset-wCiPdWyC.js";import"./index-ItegxLkj.js";import"./cn-BeZJAfOK.js";import"./Component-0YPDwg8K.js";import"./bootstrap-Gpg-_wXy.js";import"./card-CaO4-TpS.js";import"./scroll-area-C-wQRfLo.js";function s(u){if(!u)return!1;const C=u.data.current;return C?.type==="Column"||C?.type==="Task"}const W=[{id:"todo",title:"待办"},{id:"in-progress",title:"进行中"},{id:"done",title:"已完成"}],X=[{id:"task1",columnId:"done",content:"项目启动和规划"},{id:"task2",columnId:"done",content:"收集利益相关者需求"},{id:"task3",columnId:"done",content:"创建线框图和原型"},{id:"task4",columnId:"in-progress",content:"开发首页布局"},{id:"task5",columnId:"in-progress",content:"设计配色方案和排版"},{id:"task6",columnId:"todo",content:"实现用户认证"},{id:"task7",columnId:"todo",content:"构建联系我们页面"},{id:"task8",columnId:"todo",content:"创建产品目录"},{id:"task9",columnId:"todo",content:"开发关于我们页面"},{id:"task10",columnId:"todo",content:"优化网站移动端适配"},{id:"task11",columnId:"todo",content:"集成支付网关"},{id:"task12",columnId:"todo",content:"执行测试和修复bug"},{id:"task13",columnId:"todo",content:"网站上线和服务器部署"}];function ut(){const[u,C]=k.useState(W),c=k.useRef(null),d=k.useMemo(()=>u.map(n=>n.id),[u]),[g,O]=k.useState(X),[T,j]=k.useState(null),[b,w]=k.useState(null),E=G(A(J),A(H),A(F,{coordinateGetter:V}));function $(n,t){const o=g.filter(i=>i.columnId===t),e=o.findIndex(i=>i.id===n),a=u.find(i=>i.id===t);return{tasksInColumn:o,taskPosition:e,column:a}}const M={onDragStart({active:n}){if(s(n)){if(n.data.current?.type==="Column"){const t=d.indexOf(n.id);return`Picked up Column ${u[t]?.title} at position: ${t+1} of ${d.length}`}else if(n.data.current?.type==="Task"){c.current=n.data.current.task.columnId;const{tasksInColumn:t,taskPosition:o,column:e}=$(n.id,c.current);return`Picked up Task ${n.data.current.task.content} at position: ${o+1} of ${t.length} in column ${e?.title}`}}},onDragOver({active:n,over:t}){if(!(!s(n)||!s(t))){if(n.data.current?.type==="Column"&&t.data.current?.type==="Column"){const o=d.indexOf(t.id);return`Column ${n.data.current.column.title} was moved over ${t.data.current.column.title} at position ${o+1} of ${d.length}`}else if(n.data.current?.type==="Task"&&t.data.current?.type==="Task"){const{tasksInColumn:o,taskPosition:e,column:a}=$(t.id,t.data.current.task.columnId);return t.data.current.task.columnId!==c.current?`Task ${n.data.current.task.content} was moved over column ${a?.title} in position ${e+1} of ${o.length}`:`Task was moved over position ${e+1} of ${o.length} in column ${a?.title}`}}},onDragEnd({active:n,over:t}){if(!s(n)||!s(t)){c.current=null;return}if(n.data.current?.type==="Column"&&t.data.current?.type==="Column"){const o=d.indexOf(t.id);return`Column ${n.data.current.column.title} was dropped into position ${o+1} of ${d.length}`}else if(n.data.current?.type==="Task"&&t.data.current?.type==="Task"){const{tasksInColumn:o,taskPosition:e,column:a}=$(t.id,t.data.current.task.columnId);return t.data.current.task.columnId!==c.current?`Task was dropped into column ${a?.title} in position ${e+1} of ${o.length}`:`Task was dropped into position ${e+1} of ${o.length} in column ${a?.title}`}c.current=null},onDragCancel({active:n}){if(c.current=null,!!s(n))return`Dragging ${n.data.current?.type} cancelled.`}};return f.jsxs(U,{accessibility:{announcements:M},onDragEnd:K,onDragOver:R,onDragStart:B,sensors:E,children:[f.jsx(N,{children:f.jsx(q,{items:d,children:u.map(n=>f.jsx(P,{column:n,tasks:g.filter(t=>t.columnId===n.id)},n.id))})}),"document"in window&&L.createPortal(f.jsxs(z,{children:[T&&f.jsx(P,{column:T,isOverlay:!0,tasks:g.filter(n=>n.columnId===T.id)}),b&&f.jsx(Q,{isOverlay:!0,task:b})]}),document.body)]});function B(n){if(!s(n.active))return;const t=n.active.data.current;if(t?.type==="Column"){j(t.column);return}t?.type==="Task"&&w(t.task)}function K(n){j(null),w(null);const{active:t,over:o}=n;if(!o)return;const e=t.id,a=o.id;if(!s(t))return;const i=t.data.current;e===a||!(i?.type==="Column")||C(l=>{const D=l.findIndex(r=>r.id===e),v=l.findIndex(r=>r.id===a);return x(l,D,v)})}function R(n){const{active:t,over:o}=n;if(!o)return;const e=t.id,a=o.id;if(e===a||!s(t)||!s(o))return;const i=t.data.current,y=o.data.current,l=i?.type==="Task",D=y?.type==="Task";if(!l)return;l&&D&&O(r=>{const m=r.findIndex(S=>S.id===e),p=r.findIndex(S=>S.id===a),I=r[m],h=r[p];return I&&h&&I.columnId!==h.columnId?(I.columnId=h.columnId,x(r,m,p-1)):x(r,m,p)});const v=y?.type==="Column";l&&v&&O(r=>{const m=r.findIndex(I=>I.id===e),p=r[m];return p?(p.columnId=a,x(r,m,m)):r})}}export{ut as KanbanBoard};
